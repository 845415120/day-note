小时候因为家里穷，经常到工地打工，有一天，包工头让我独自为客户建一座房子，于是就把施工合同递给我，对于从小就熟读《三只小猪》的我，怎么可能不认识合同上面的内容？

于是，我就对照做了一个迷你框架结构的模型，浏览器渲染页面的过程就像盖房子似的，一般先请求服务器得到HTML文件, HTML就相当于网页的框架结构


不过一开始浏览器得到的是显示字节内容的HTML文件，必须要内化为自己看得懂的语言才行，于是就把字节转换为字符，也就是给程序员看懂的HTML代码，但不好意思哦，人类看懂，机器看不懂

得开始转换为机器看得懂的语言，还好HTML是标记语言，里面有很多小于号<和大于号>分别标识不同的结构，于是浏览器就把字符转换为Token，可以简单把Token理解为符号标签

比如遇到第一个< body>的时候转换为一个起始标签，遇到结尾的< /body>时转换为结束标签，这样制符就被“Token化”了，不同字符就变成有不同特殊意义的东西了

Token化以后就要开始升华了，也就是把Token转变为节点对象，在编程里面，对象虽然只是用代码表示而已，但是对象是可以进行编程操作的，因为对象会有自己的属性方法，相当于把Token盘活了


最后，就是把这些节点对象都连在一起，形成文本对象模型，也就是DOM，DOM其实就是浏览器自己的语言，每个节点对象相连，形成父子关系

这样，后面要对某个节点对象进行操作，对于浏览器来说就非常友好了，从HTML转变为DOM，正如我把施工合同转变为迷你框架结构模型

在阅读施工合同的时候，其实我也同时阅读了甲方的装饰要求，在制作迷你框架结构模型的同时，我也在给模型做装修，比如给墙面上色之类的，一般来说，我们会把CSS样式作为外链加入到link标签里面，


CSS就相当于网页的“装饰”，浏览器在构建DOM的时候就会遇到Link标签，然后向服务器发送请求，接着得到CSS文件，后面的流程就和处理HTML文件非常相似，把字节转换为字符，字符转换为Token，Token转变为节点，最后就是不同的地方了，这里节点会结合为CSS对象模型，也就是CSSOM


DOM和CSSOM还有一些很多人会忽略的不同之处，我们等会再讲解，迷你模型加上装修，也就是房子的模型完成了，有了模型房子就更容易搭建了，我们画画的时候也是需要参考模特来画的，不然就不成样了

虽然DOM和CSSOM都是独立的对象模型，但是一个网页的呈现离不开两者，因为一个网页就是由框架结构和样式结合起来，DOM和CSSOM的爱情结晶就是渲染树，页面就是要根据渲染树的结构样式来进行的，但是DOM和CSSOM不是简单地进行结合就完事了，因为渲染树上的节点是页面能够呈现的内容，也就是一些HTML标签和某些样式是不会被呈现出来的，不会被呈现出来就不挂在渲染树上


比如meta和link标签就不会当作内容呈现出来，设置了display:none的样式也不会被呈现出来，渲染树的任务就是匹配DOM和CSSOM的节点，并且捕获可见内容，虽然房子模型已经做好了，但不代表我就能马上建房子了，我还得安排实际房子上的布局，实际上房子需要多少块砖头，需要多少吨水泥等等

在渲染处构造完成以后，页面也是不能被马上渲染的，因为还需要进行布局，布局的意思就是获取渲染树的结构，节点位置和大小，而布局是依据盒子模型来进行的，也就是每个元素都用一个盒子来表示，然后这些盒子在页面上进行排列和嵌套


在安排好房子的布局以后，我就开始建房子了。大家来参观一下我建好的房子，浏览器在布局以后，其实就可以安排页面的绘制了，把渲染树以像素的形式绘制在页面，这样我们的页面就呈现出来了


可能有同学以为浏览器渲染页面的过程就这样讲完了，但是进度条告诉你事情没那么简单，了解了渲染的基本过程以后，接下来我们就可以接合实际来深入了解了，来看看这段简单的HTML代码，结合我们刚刚学的流程，同学们尝试复述一下过程


首先第一步是什么？请大声告诉我，浏览器发送请求以后服务器或者本地返回浏览器HTML文件，这个时候第一步就是解析HTML文件，并且构建DOM


在解析HTML文件的时候，遇到了link标签浏览器就去请求CSS文件，请求CSS文件的同时也继续解析HTML文件，此时遇到了script标签浏览器就去请求JS文件


服务器或者本地就会陆续返回CSS和JS文件，实际操作中会先得到CSS还是JS文件，是要看具体情况的，但是这里有个重点听好了，我先喝口水。


在这里，如果先返回并且解析完成JS文件也是会发生阻塞，我们不能先执行JS文件，必须等到CSSOM构建完成了以后才能执行JS文件


因为前面说过，渲染树是需要DOM和CSSOM构建完成了以后才能构建，而且JS 是可以操控CSS样式的，所以这一步就是解析CSS文件并且构建CSSOM，但这个时候有同学可能会问


如果script标签里面写的是行内JS代码，而不是外部JS文件，也会发生阻塞吗？我的回答还是：会！CSSOM的构建，就是渲染中一个重要的阻塞因素，其实DOM也是会阻塞渲染过程

毕竟没有DOM，网页的框架都建造不起来，但是DOM有一点好处，就是可以部分解析，而CSSOM不能部分解析，这就是前面没有给你们讲的DOM和CSSOM不同之处，可能又有同学会问，为什么DOM可以部分解析？CSSOM却不能？


老师是不是预判了你们的预判？我们仔细想想就知道了，比如我们给body设置了字体为32px，然后我们又给body里面的div设置了字体为16px，如果CSSOM只解析了body，后面的div没有解析或者延迟解析，那就乱套了，所以CSSOM不能进行部分解析，不过在解析CSSOM文件并且构建CSSOM的时候，浏览器依旧可以去下载并且解析JS文件，等CSSOM构建完成以后就可以执行JS里的内容了

不过，大家有没有发现HTML的解析刚刚就停止了，原因可能很多同学都知道，因为JS是会阻塞HTML解析的，虽然看起来JS并没有直接阻塞渲染过程，但是有间接的影响

因为JS既可以操作DOM，又可以操作CSSOM，如果不等JS下载解析执行完以后再构建DOM，那有可能会导致网页的有些内容出现了又消失，所以在解析HTML的时候，不管是行内JS代码还是外部JS代码，都会让HTML的解析停止下来，虽然DOM是可以部分解析的，但是对于这个网页来说，就相当于阻塞了第一次的渲染


JS执行完成之前什么内容都没有，在JS执行完了以后，下面的流程就很正常了，也就是形成渲染树（构建DOM后）进行布局，最后绘制，知道浏览器渲染页面的过程，并不是背下来这个过程就好了，重要的还是理解这个过程


这样在日常开发中才知道怎么做 可以让用户更快看到页面，所以如果刚刚的代码改成这样


渲染过程大家还能回答出来吗？在请求得到HTML文件的时候，就开始解析HTML文件以构建DOM，解析遇到link标签需要请求CSS文件，在请求CSS文件的同时，继续解析HTML，遇到了script标签需要请求JS文件，不过这里因为设置了async，也就是异步执行JS，因此不会阻塞HTML的解析，


这个时候遇到了img标签，因此需要下载图片资源，但是大家不要以为图片会阻塞HTML的解析，因此，继续往下继续解析，直到把DOM构件完成，不过即使DOM构建完成，也不能渲染页面，因为要等CSSOM，因此等待解析CSS文件，构建CSSOM，由于设置了async等script标签，执行时间要看实际情况


假设我们就在这里执行了JS内容，接着就是构建渲染树，布局以及绘制了，现在我们就可以来总结流程了

第一步，构建DOM

第二步，构建CSSOM

第三步，构建渲染树

第四步，布局

第五步，绘制


如果构建DOM的时候遇到了JS，就请求下载执行JS，JS如果没有额外的设置，默认要等CSSOM构建完成，而JS既可以对DOM，也可以对CSSOM进行修改，这样后面的三步又会再运行一次

 作者：小塔-Zrea https://www.bilibili.com/read/cv21328306/?spm_id_from=333.999.0.0&jump_opus=1 出处：bilibili