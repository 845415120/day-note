---
时间: 11分
作者: "\r技术蛋老师"
标题: JavaScript节流
图片: https://i2.hdslb.com/bfs/archive/dc995e2ab0930524193e23f03ae0ac7053f86efc.jpg@480w_300h_1c_!web-space-channel-video.webp
链接: https://www.bilibili.com/video/BV11Z4y1c7C9
评价: ★★★★★
---
## 节流

节流（throttle）指的是：单位时间内，频繁触发同一个操作，只会触发 1 次。

- 频繁触发某个事件的时候，比如触发 mousemove 、scroll 等 事件的时候
- 可能 1s 中只内，鼠标移动事件就会触发 10次，事件中代码就会执行10次，太频繁了
- 我们通过 JS代码控制，1s中之内，事件中的代码最多只能执行1次，这种减低频率的行为就是节流。

![](https://cdn.nlark.com/yuque/0/2022/png/22014993/1660752294442-3cea30f7-9553-4e71-82ab-3675f1ec7464.png#averageHue=%23fbf6f4&clientId=ua6a49c73-4731-4&from=paste&height=350&id=u89e7ad24&originHeight=600&originWidth=758&originalType=binary&ratio=1&rotation=0&showTitle=false&size=120582&status=done&style=none&taskId=u6ee3a67f-8720-41fb-8a52-1f97a4d30dc&title=&width=442.3999938964844)  
节流一般通过计算时间差来实现：

- 事件触发之前，定义当前 时间 start
- 事件触发后，获取 当前事件 now，然后用 now - start ，如果大于约定时间，则允许执行事件中的代码
- 事件中代码执行完，重置 start

```
<div style="background-color: pink; width: 300px; height: 300px"></div>
<script>
  let prev = Date.now() // 时间戳，单位毫秒
  document.querySelector('div').addEventListener('mousemove', function () {
    // console.log('事件触发了')
    let now = Date.now() // 事件触发时的诗句
    if (now - prev >= 1000) {
      console.log('这是一万行代码')
      prev = Date.now()
    }
  })
</script>
```

**实际开发中，建议使用 lodash 封装的** `**_.throttle(需要节流的函数, 间隔时间)**`

```js
// ---------------------- 使用lodash提供的函数节流 ---------------------------
// document.querySelector('div').addEventListener('mousemove', 函数)
// document.querySelector('div').addEventListener('mousemove', _.throttle(函数, 1000))
document.querySelector('div').addEventListener('mousemove', _.throttle(function () {
    console.log('一万行代码')
}, 1000))
```

## 视频播放位置案例

```js
let video = document.querySelector('video')

// 当视频播放的时候，播放的时间只要发生改变，就会触发下面的事件
video.addEventListener('timeupdate', _.throttle(function () {
  // console.log('视频播放到了', video.currentTime)
  // 将视频的播放时间，记录到本地存储
  localStorage.setItem('time', video.currentTime)
}, 1000))

// 引入的视频资源，如果可以播放了（开头加载好了），就会触发这个事件 ：loadeddata
video.addEventListener('loadeddata', function () {
  // video.currentTime = 本地存储中 存储的时间
  video.currentTime = localStorage.getItem('time')
})
```




节流和防抖的区别是？

- 节流：频繁触发事件时，降低事件内代码的执行频率。 --- 降频
- 防抖：连续触发事件时，每触发一次事件就重新计时。 --- 重新计时，延迟执行

节流和防抖的使用场景是？

- 节流：会频繁触发的事件，比如鼠标移动，页面尺寸发生变化，滚动条滚动等，适合使用节流降频。
- 防抖：只需在最后一次触发事件时，就可以完成最终效果的情况下，比如搜索框输入，适合使用防抖。