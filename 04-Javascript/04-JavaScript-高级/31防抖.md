---
时间: 11分
作者: "\r技术蛋老师"
标题: JavaScript防抖
图片: https://i1.hdslb.com/bfs/archive/388207d4c5a9d0fa5437a0326ca116af551be22a.jpg@480w_300h_1c_!web-space-channel-video.webp
链接: https://www.bilibili.com/video/BV17b4y1X7yp
评价: ★★★★★
---
# 防抖和节流

- 节流: n 秒内只运行一次，若在 n 秒内重复触发，只有一次执行
- 防抖: n 秒后在执行该事件，若在 n 秒内被重复触发，则重新计时


## 防抖

防抖（debounce）指的是：频繁触发某个操作时，只执行最后一次。

- 触发事件后，延迟一段时间（比如1s）执行事件中的代码
- 如果在这 1s 中之内，再次触发了该事件，则重新计时 1s，1s后执行事件中的代码
- 如果 1s 中之内，没有再次触发事件，则 1s 后就执行事件中的代码

![](https://cdn.nlark.com/yuque/0/2022/png/22014993/1660751868044-914d9cfa-f9d9-477e-9e76-60e955628f31.png#averageHue=%23fbf8f6&clientId=ua6a49c73-4731-4&from=paste&height=357&id=uc7b46576&originHeight=661&originWidth=683&originalType=binary&ratio=1&rotation=0&showTitle=false&size=151848&status=done&style=none&taskId=u60b94d57-c980-4ab3-9430-174747c1185&title=&width=368.4000244140625)  
![](https://cdn.nlark.com/yuque/0/2022/gif/22014993/1660752002488-f0223120-6555-4466-92d6-2791fec9e773.gif#averageHue=%23627953&clientId=ua6a49c73-4731-4&from=paste&height=282&id=u25e4f191&originHeight=225&originWidth=400&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u76a886d1-73c6-47a9-aca2-b51bf013fc1&title=&width=502)  
防抖一般通过定时器来实现：

- 当事件触发后，清除定时器（如果有的话）
- 将要执行的代码放到定时器中

下面是输入框的防抖：用户在输入框输入，只输出最终的结果。

```
<input type="text" />
<script>
  let timer
  document.querySelector('input').addEventListener('input', function () {
    // 清除可能存在的定时器
    clearTimeout(timer)
    timer = setTimeout(() => {
      console.log(this.value)
    }, 1000)
  })
</script>
```

**实际开发中，建议使用 lodash 封装好的** `**_.debounce(需要防抖的函数, 延迟时间)**`

```
// ------------------------------- 使用 lodash 的方法方法 ---------------------------
// document.querySelector('input').addEventListener('input', 函数)
// document.querySelector('input').addEventListener('input', _.debounce(函数, 1000))
document.querySelector('input').addEventListener('input', _.debounce(function () {
    console.log(this.value)
}, 1000))
```

## 淘宝搜索建议案例

```
// 加入 lodash 提供的 _.debounce(函数, 1000)

// 在输入框中输入商品，输入商品后，下面div中显示搜索建议。
// 找到输入框，注册 input 事件
document.querySelector('input').addEventListener('input', _.debounce(async function () {
  // 1. 获取输入框的值
  let val = this.value
  // 2. 判断，值是否为空
  if (val === '') {
    return (document.querySelector('#suggest-list').innerHTML = '')
  }
  // 3. 输入框中有值，则发送请求，获取搜索建议
  const { data: res } = await axios.get('http://www.itcbc.com:3006/api/suggest', {
    params: { q: val }
  })
  // console.log(res)
  let arr = res.result.map(item => {
    return `<div class="suggest-item">${item[0]}</div>`
  })
  document.querySelector('#suggest-list').innerHTML = arr.join('')
}, 1000))
```
